{% extends 'base.html' %}
{% load role_tags %}

{% block title %}Reports & Analytics - DAAA{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Delegation Status Badges -->
    {% show_delegation_badges user %}

    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card" style="background: var(--royal-blue-gradient); color: white;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="mb-1 fw-bold">Reports & Analytics</h1>
                            <p class="mb-0 opacity-75">Generate comprehensive reports and export university data</p>
                        </div>
                        <div class="col-md-4 text-center">
                            <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 12px;">
                                <div class="h3 fw-bold mb-0">{{ analytics.total_students|default:"0" }}</div>
                                <small class="opacity-75">Total Students</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Export Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title fw-bold text-primary mb-3">Quick Exports</h5>
                    <div class="row g-3">
                        <div class="col-md-3">
                            <a href="{% url 'daaa_export_university' %}?type=university_summary" class="btn btn-primary w-100">
                                <i class="bi bi-building me-2"></i>University Summary
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'daaa_export_university' %}?type=all_student_results" class="btn btn-outline-secondary w-100">
                                <i class="bi bi-file-earmark-spreadsheet me-2"></i>All Student Results
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'daaa_export_university' %}?type=all_carryovers" class="btn btn-outline-warning w-100">
                                <i class="bi bi-exclamation-triangle me-2"></i>All Carryovers
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{% url 'daaa_export_university' %}?type=all_students" class="btn btn-outline-info w-100">
                                <i class="bi bi-people me-2"></i>All Students
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Overview -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="h2 text-primary fw-bold mb-1">{{ analytics.total_students|default:"0" }}</div>
                    <div class="text-muted">Total Students</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="h2 text-success fw-bold mb-1">{{ analytics.average_gpa|floatformat:2|default:"0.00" }}</div>
                    <div class="text-muted">Average GPA</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="h2 text-warning fw-bold mb-1">{{ analytics.carryover_rate|floatformat:1|default:"0.0" }}%</div>
                    <div class="text-muted">Carryover Rate</div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="h2 text-info fw-bold mb-1">{{ analytics.graduation_rate|floatformat:1|default:"0.0" }}%</div>
                    <div class="text-muted">Graduation Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Categories -->
    <div class="row mb-4">
        <!-- Academic Reports -->
        <div class="col-lg-6 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title fw-bold text-primary mb-3">Academic Reports</h5>

                    <h6 class="text-secondary mb-2">Student Performance</h6>
                    <div class="row g-2 mb-3">
                        <div class="col-6">
                            <a href="{% url 'daaa_student_performance_report' %}" class="btn btn-outline-primary btn-sm w-100">
                                Performance Report
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{% url 'daaa_gpa_analysis' %}" class="btn btn-outline-primary btn-sm w-100">
                                GPA Analysis
                            </a>
                        </div>
                    </div>

                    <h6 class="text-secondary mb-2">Course Analysis</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <a href="{% url 'daaa_course_performance' %}" class="btn btn-outline-secondary btn-sm w-100">
                                Course Performance
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{% url 'daaa_pass_rate_analysis' %}" class="btn btn-outline-secondary btn-sm w-100">
                                Pass Rate Analysis
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Administrative Reports -->
        <div class="col-lg-6 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title fw-bold text-primary mb-3">Administrative Reports</h5>

                    <h6 class="text-secondary mb-2">Faculty & Department</h6>
                    <div class="row g-2 mb-3">
                        <div class="col-6">
                            <a href="{% url 'daaa_faculty_comparison' %}" class="btn btn-outline-primary btn-sm w-100">
                                Faculty Comparison
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{% url 'daaa_department_analysis' %}" class="btn btn-outline-primary btn-sm w-100">
                                Department Analysis
                            </a>
                        </div>
                    </div>

                    <h6 class="text-secondary mb-2">Session Reports</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <a href="{% url 'daaa_session_summary' %}" class="btn btn-outline-secondary btn-sm w-100">
                                Session Summary
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{% url 'daaa_workflow_analysis' %}" class="btn btn-outline-secondary btn-sm w-100">
                                Workflow Analysis
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Report Builder -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title fw-bold text-primary mb-3">Custom Report Builder</h5>
                    <form method="get" action="{% url 'daaa_custom_report' %}">
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Report Type</label>
                                <select name="report_type" required class="form-select">
                                    <option value="">Select Report Type</option>
                                    <option value="student_results">Student Results</option>
                                    <option value="course_performance">Course Performance</option>
                                    <option value="faculty_summary">Faculty Summary</option>
                                    <option value="carryover_analysis">Carryover Analysis</option>
                                    <option value="enrollment_report">Enrollment Report</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Faculty</label>
                                <select name="faculty" class="form-select">
                                    <option value="">All Faculties</option>
                                    {% for faculty in faculties %}
                                    <option value="{{ faculty.id }}">{{ faculty.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Export Format</label>
                                <select name="format" class="form-select">
                                    <option value="excel">Excel (.xlsx)</option>
                                    <option value="pdf">PDF</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-download me-2"></i>Generate Report
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}