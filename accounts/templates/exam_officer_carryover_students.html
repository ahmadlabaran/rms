{% extends 'base.html' %} {% load role_tags %} {% block title %}Carry-Over Students - Exam Officer{% endblock %} {% block content %} <div class="container-fluid"> <!-- Delegation Status Badges --> {% show_delegation_badges user %} <!-- Header --> <div class="row mb-4"> <div class="col-12"> <div class="card" style="background: var(--royal-blue-gradient); color: white;"> <div class="card-body"> <div class="row align-items-center"> <div class="col-md-8"> <h1 class="mb-1 fw-bold">Carry-Over Students Management</h1> <p class="mb-0 opacity-75">Manage students who need to retake failed courses</p> </div> <div class="col-md-4 text-center"> <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 12px;"> <div class="h3 fw-bold mb-0">{{ total_carryovers }}</div> <small class="opacity-75">Carry-Over Students</small> </div> </div> </div> </div> </div> </div> </div> <!-- Faculty Info & Actions --> <div class="row mb-4"> <div class="col-md-8"> <div class="alert alert-info"> <div class="d-flex align-items-center"> <i class="bi bi-building me-2 fs-4"></i> <div> <h6 class="mb-0">Faculty: {{ faculty.name }}</h6> <small>Managing carry-over students for your faculty</small> </div> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-body text-center"> <h6 class="card-title">Quick Actions</h6> <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#identifyCarryoversModal"> <i class="bi bi-search me-1"></i>Identify New Carry-Overs </button> </div> </div> </div> </div> <!-- Statistics Cards --> <div class="row mb-4"> <div class="col-md-3"> <div class="card text-center border-warning"> <div class="card-body"> <div class="h4 fw-bold text-warning">{{ status_stats.IDENTIFIED|default:0 }}</div> <small class="text-muted">Identified</small> </div> </div> </div> <div class="col-md-3"> <div class="card text-center border-info"> <div class="card-body"> <div class="h4 fw-bold text-info">{{ status_stats.NOTIFIED|default:0 }}</div> <small class="text-muted">Notified</small> </div> </div> </div> <div class="col-md-3"> <div class="card text-center border-primary"> <div class="card-body"> <div class="h4 fw-bold text-primary">{{ status_stats.REGISTERED|default:0 }}</div> <small class="text-muted">Registered</small> </div> </div> </div> <div class="col-md-3"> <div class="card text-center border-success"> <div class="card-body"> <div class="h4 fw-bold text-success">{{ status_stats.COMPLETED|default:0 }}</div> <small class="text-muted">Completed</small> </div> </div> </div> </div> <!-- Filters --> <div class="row mb-4"> <div class="col-12"> <div class="card"> <div class="card-header"> <h6 class="mb-0">Filters</h6> </div> <div class="card-body"> <form method="get" class="row g-3"> <div class="col-md-3"> <label class="form-label">Level</label> <select name="level" class="form-select"> <option value="">All Levels</option> {% for level in levels %} <option value="{{ level.id }}" {% if level_filter == level.id|stringformat:"s" %}selected{% endif %}> {{ level.name }} </option> {% endfor %} </select> </div> <div class="col-md-3"> <label class="form-label">Department</label> <select name="department" class="form-select"> <option value="">All Departments</option> {% for department in departments %} <option value="{{ department.id }}" {% if department_filter == department.id|stringformat:"s" %}selected{% endif %}> {{ department.name }} </option> {% endfor %} </select> </div> <div class="col-md-3"> <label class="form-label">Status</label> <select name="status" class="form-select"> <option value="">All Statuses</option> <option value="IDENTIFIED" {% if status_filter == "IDENTIFIED" %}selected{% endif %}>Identified</option> <option value="NOTIFIED" {% if status_filter == "NOTIFIED" %}selected{% endif %}>Notified</option> <option value="REGISTERED" {% if status_filter == "REGISTERED" %}selected{% endif %}>Registered</option> <option value="COMPLETED" {% if status_filter == "COMPLETED" %}selected{% endif %}>Completed</option> </select> </div> <div class="col-md-3"> <label class="form-label">Session</label> <select name="session" class="form-select"> <option value="">All Sessions</option> {% for session in sessions %} <option value="{{ session.id }}" {% if session_filter == session.id|stringformat:"s" %}selected{% endif %}> {{ session.name }} </option> {% endfor %} </select> </div> <div class="col-12"> <button type="submit" class="btn btn-primary"> <i class="bi bi-funnel me-1"></i>Apply Filters </button> <a href="{% url 'exam_officer_carryover_students' %}" class="btn btn-outline-secondary"> <i class="bi bi-x-circle me-1"></i>Clear Filters </a> </div> </form> </div> </div> </div> </div> <!-- Carry-Over Students Table --> <div class="row"> <div class="col-12"> <div class="card"> <div class="card-header d-flex justify-content-between align-items-center"> <h5 class="mb-0 fw-bold">Carry-Over Students</h5> <a href="{% url 'exam_officer_dashboard' %}" class="btn btn-outline-secondary btn-sm"> <i class="bi bi-arrow-left me-1"></i>Back to Dashboard </a> </div> <div class="card-body"> {% if carryover_students %} <div class="table-responsive"> <table class="table table-hover"> <thead class="table-light"> <tr> <th>Student</th> <th>Matric Number</th> <th>Level</th> <th>Department</th> <th>Failed Course</th> <th>Score</th> <th>Grade</th> <th>Session</th> <th>Status</th> <th>Actions</th> </tr> </thead> <tbody> {% for carryover in carryover_students %} <tr> <td> <div class="fw-bold">{{ carryover.student.user.get_full_name }}</div> </td> <td> <span class="badge bg-info">{{ carryover.student.matric_number }}</span> </td> <td> <span class="badge bg-secondary">{{ carryover.level.name }}</span> </td> <td> <small class="text-muted">{{ carryover.department.name }}</small> </td> <td> <div class="fw-bold text-primary">{{ carryover.course.code }}</div> <small class="text-muted">{{ carryover.course.title }}</small> </td> <td> <span class="text-danger fw-bold">{{ carryover.failed_score|floatformat:1 }}</span> <small class="text-muted d-block">/ {{ carryover.passing_threshold|floatformat:1 }}</small> </td> <td> <span class="badge bg-danger">{{ carryover.failed_grade }}</span> </td> <td> <small class="text-muted">{{ carryover.session.name }}</small> </td> <td> {% if carryover.status == 'IDENTIFIED' %} <span class="badge bg-warning">Identified</span> {% elif carryover.status == 'NOTIFIED' %} <span class="badge bg-info">Notified</span> {% elif carryover.status == 'REGISTERED' %} <span class="badge bg-primary">Registered</span> {% elif carryover.status == 'COMPLETED' %} <span class="badge bg-success">Completed</span> {% endif %} </td> <td> <button class="btn btn-outline-primary btn-sm" onclick="updateStatus({{ carryover.id }}, '{{ carryover.student.matric_number }}', '{{ carryover.status }}')" title="Update Status"> <i class="bi bi-pencil"></i> </button> </td> </tr> {% endfor %} </tbody> </table> </div> {% else %} <div class="text-center py-5"> <div class="mb-3"> <i class="bi bi-person-check display-1 text-muted"></i> </div> <h4 class="text-muted">No Carry-Over Students Found</h4> <p class="text-muted"> {% if level_filter or department_filter or status_filter or session_filter %} No carry-over students match your current filters. {% else %} No carry-over students have been identified yet. {% endif %} </p> <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#identifyCarryoversModal"> <i class="bi bi-search me-1"></i>Identify Carry-Over Students </button> </div> {% endif %} </div> </div> </div> </div> </div> <!-- Identify Carry-Overs Modal --> <div class="modal " id="identifyCarryoversModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title">Identify Carry-Over Students</h5> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <form method="post"> {% csrf_token %} <div class="modal-body"> <input type="hidden" name="action" value="identify_carryovers"> <div class="alert alert-info"> <i class="bi bi-info-circle me-2"></i> This will scan published results and automatically identify students who failed courses based on your faculty's grading thresholds. </div> <div class="mb-3"> <label class="form-label">Academic Session (Optional)</label> <select name="session_id" class="form-select"> <option value="">All Sessions</option> {% for session in sessions %} <option value="{{ session.id }}">{{ session.name }}</option> {% endfor %} </select> <div class="form-text">Leave blank to scan all sessions</div> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button> <button type="submit" class="btn btn-primary"> <i class="bi bi-search me-1"></i>Identify Carry-Overs </button> </div> </form> </div> </div> </div> <!-- Update Status Modal --> <div class="modal " id="updateStatusModal" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title">Update Carry-Over Status</h5> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <form method="post" id="updateStatusForm"> {% csrf_token %} <div class="modal-body"> <input type="hidden" name="action" value="update_status"> <input type="hidden" name="carryover_id" id="updateCarryoverId"> <div class="mb-3"> <label class="form-label">Student</label> <input type="text" class="form-control" id="updateStudentId" readonly> </div> <div class="mb-3"> <label class="form-label">Status</label> <select name="status" class="form-select" id="updateStatus" required> <option value="IDENTIFIED">Identified</option> <option value="NOTIFIED">Notified</option> <option value="REGISTERED">Registered for Retake</option> <option value="COMPLETED">Completed Retake</option> </select> </div> <div class="mb-3"> <label class="form-label">Notes (Optional)</label> <textarea name="notes" class="form-control" rows="3" placeholder="Add any administrative notes..."></textarea> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button> <button type="submit" class="btn btn-primary"> <i class="bi bi-check-circle me-1"></i>Update Status </button> </div> </form> </div> </div> </div> <script> function updateStatus(carryoverId, studentId, currentStatus) { document.getElementById('updateCarryoverId').value = carryoverId; document.getElementById('updateStudentId').value = studentId; document.getElementById('updateStatus').value = currentStatus; new bootstrap.Modal(document.getElementById('updateStatusModal')).show(); } </script> {% endblock %} 