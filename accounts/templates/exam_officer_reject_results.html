{% extends 'base.html' %} {% load role_tags %} {% block title %}Result Rejection Management - Exam Officer{% endblock %} {% block content %} <div class="container-fluid"> <!-- Delegation Status Badges --> {% show_delegation_badges user %} <!-- Header --> <div class="row mb-4"> <div class="col-12"> <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white;"> <div class="card-body"> <div class="row align-items-center"> <div class="col-md-8"> <h1 class="mb-1 fw-bold">Result Rejection Management</h1> <p class="mb-0 opacity-75">Manage rejected results and rejection workflow</p> </div> <div class="col-md-4 text-center"> <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 12px;"> <div class="h3 fw-bold mb-0">{{ current_level.name }}</div> <small class="opacity-75">Current Level</small> </div> </div> </div> </div> </div> </div> </div> <!-- Level Selector --> <div class="row mb-4"> <div class="col-12"> <div class="card border-0 shadow-sm"> <div class="card-body"> <h6 class="card-title mb-3">Select Academic Level</h6> <div class="row g-2"> {% for level in levels %} <div class="col-auto"> <a href="{% url 'exam_officer_reject_results' %}?level={{ level.numeric_value }}" class="btn {% if current_level.id == level.id %}btn-danger{% else %}btn-outline-secondary{% endif %} btn-sm"> {{ level.name }} </a> </div> {% endfor %} </div> </div> </div> </div> </div> <!-- Statistics --> <div class="row mb-4"> <div class="col-md-6"> <div class="card border-0 shadow-sm"> <div class="card-body text-center"> <div class="h2 text-danger fw-bold mb-1">{{ total_rejected }}</div> <div class="text-muted">Rejected Results</div> </div> </div> </div> <div class="col-md-6"> <div class="card border-0 shadow-sm"> <div class="card-body text-center"> <div class="h2 text-warning fw-bold mb-1">{{ total_pending }}</div> <div class="text-muted">Pending Results</div> </div> </div> </div> </div> <!-- Pending Results for Rejection --> {% if pending_results %} <div class="row mb-4"> <div class="col-12"> <div class="card border-0 shadow-sm"> <div class="card-header bg-warning text-dark"> <h5 class="mb-0"><i class="bi bi-clock me-2"></i>Pending Results - Available for Rejection</h5> </div> <div class="card-body"> <div class="table-responsive"> <table class="table table-hover"> <thead> <tr> <th>Student</th> <th>Course</th> <th>CA Score</th> <th>Exam Score</th> <th>Total</th> <th>Grade</th> <th>Submitted By</th> <th>Action</th> </tr> </thead> <tbody> {% for result in pending_results %} <tr> <td> <div class="fw-semibold">{{ result.enrollment.student.matric_number }}</div> <small class="text-muted">{{ result.enrollment.student.user.get_full_name }}</small> </td> <td> <div class="fw-semibold">{{ result.enrollment.course.code }}</div> <small class="text-muted">{{ result.enrollment.course.title }}</small> </td> <td>{{ result.ca_score|default:"-" }}</td> <td>{{ result.exam_score|default:"-" }}</td> <td>{{ result.total_score|default:"-" }}</td> <td> {% if result.grade %} <span class="badge bg-primary">{{ result.grade }}</span> {% else %} <span class="text-muted">-</span> {% endif %} </td> <td>{{ result.created_by.get_full_name|default:"Unknown" }}</td> <td> <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#rejectModal{{ result.id }}"> <i class="bi bi-x-circle me-1"></i>Reject </button> </td> </tr> <!-- Rejection Modal --> <div class="modal " id="rejectModal{{ result.id }}" tabindex="-1"> <div class="modal-dialog"> <div class="modal-content"> <form method="post"> {% csrf_token %} <div class="modal-header"> <h5 class="modal-title">Reject Result</h5> <button type="button" class="btn-close" data-bs-dismiss="modal"></button> </div> <div class="modal-body"> <div class="alert alert-warning"> <strong>Student:</strong> {{ result.enrollment.student.matric_number }} - {{ result.enrollment.student.user.get_full_name }}<br> <strong>Course:</strong> {{ result.enrollment.course.code }} - {{ result.enrollment.course.title }}<br> <strong>Scores:</strong> CA: {{ result.ca_score|default:"-" }}, Exam: {{ result.exam_score|default:"-" }}, Total: {{ result.total_score|default:"-" }} </div> <div class="mb-3"> <label for="rejection_reason{{ result.id }}" class="form-label">Rejection Reason <span class="text-danger">*</span></label> <textarea class="form-control" id="rejection_reason{{ result.id }}" name="rejection_reason" rows="4" required placeholder="Please provide a detailed reason for rejecting this result..."></textarea> </div> <input type="hidden" name="result_id" value="{{ result.id }}"> <input type="hidden" name="action" value="reject_single"> </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button> <button type="submit" class="btn btn-danger"> <i class="bi bi-x-circle me-1"></i>Reject Result </button> </div> </form> </div> </div> </div> {% endfor %} </tbody> </table> </div> </div> </div> </div> </div> {% endif %} <!-- Rejected Results History --> <div class="row"> <div class="col-12"> <div class="card border-0 shadow-sm"> <div class="card-header bg-danger text-white"> <h5 class="mb-0"><i class="bi bi-x-circle me-2"></i>Rejected Results History</h5> </div> <div class="card-body"> {% if rejected_results %} <div class="table-responsive"> <table class="table table-hover"> <thead> <tr> <th>Student</th> <th>Course</th> <th>Scores</th> <th>Rejected By</th> <th>Rejection Date</th> <th>Reason</th> <th>Status</th> </tr> </thead> <tbody> {% for result in rejected_results %} <tr> <td> <div class="fw-semibold">{{ result.enrollment.student.matric_number }}</div> <small class="text-muted">{{ result.enrollment.student.user.get_full_name }}</small> </td> <td> <div class="fw-semibold">{{ result.enrollment.course.code }}</div> <small class="text-muted">{{ result.enrollment.course.title }}</small> </td> <td> <small> CA: {{ result.ca_score|default:"-" }}<br> Exam: {{ result.exam_score|default:"-" }}<br> Total: {{ result.total_score|default:"-" }} </small> </td> <td>{{ result.rejected_by.get_full_name|default:"Unknown" }}</td> <td>{{ result.rejection_date|date:"M d, Y H:i" }}</td> <td> <small class="text-muted">{{ result.rejection_reason|truncatewords:10 }}</small> </td> <td> <span class="badge bg-danger">{{ result.get_status_display }}</span> </td> </tr> {% endfor %} </tbody> </table> </div> {% else %} <div class="text-center py-4"> <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i> <h5 class="mt-3 text-muted">No Rejected Results</h5> <p class="text-muted">All results for {{ current_level.name }} have been processed successfully.</p> </div> {% endif %} </div> </div> </div> </div> <!-- Back to Dashboard --> <div class="row mt-4"> <div class="col-12"> <a href="{% url 'exam_officer_dashboard' %}" class="btn btn-secondary"> <i class="bi bi-arrow-left me-2"></i>Back to Dashboard </a> </div> </div> </div> {% endblock %} 