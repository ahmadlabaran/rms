{% extends 'base.html' %} {% load role_tags %} {% block title %}Result History - Exam Officer{% endblock %} {% block content %} <div class="container-fluid"> <!-- Delegation Status Badges --> {% show_delegation_badges user %} <!-- Header --> <div class="row mb-4"> <div class="col-12"> <div class="card" style="background: var(--royal-blue-gradient); color: white;"> <div class="card-body"> <div class="row align-items-center"> <div class="col-md-8"> <h1 class="mb-1 fw-bold">Result History</h1> <p class="mb-0 opacity-75">View processed results for {% if show_all_levels %}All Levels{% else %}{{ current_level.name }}{% endif %}</p> </div> <div class="col-md-4 text-center"> <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 12px;"> <div class="h3 fw-bold mb-0">{{ stats.total_processed }}</div> <small class="opacity-75">Processed Results</small> </div> </div> </div> </div> </div> </div> </div> <!-- Level Selector --> <div class="card border-0 shadow-sm mb-4"> <div class="card-body"> <div class="row align-items-center"> <div class="col-md-6"> <h5 class="card-title fw-bold text-primary mb-0">Select Academic Level</h5> <small class="text-muted">Choose level to view processed results</small> </div> <div class="col-md-6"> <div class="row g-2"> {% for level in levels %} <div class="col-auto"> <a href="{% url 'exam_officer_result_history' %}?level={{ level.numeric_value }}" class="btn {% if current_level.id == level.id %}btn-primary{% else %}btn-outline-secondary{% endif %} btn-sm"> {{ level.name }} </a> </div> {% endfor %} <div class="col-auto"> <a href="{% url 'exam_officer_result_history' %}?level=all" class="btn {% if show_all_levels %}btn-success{% else %}btn-outline-success{% endif %} btn-sm"> <i class="bi bi-list-ul me-1"></i>All Levels </a> </div> </div> </div> </div> </div> </div> <!-- Statistics Cards --> <div class="row mb-4"> <div class="col-md-4"> <div class="card border-0 shadow-sm"> <div class="card-body text-center"> <div class="h2 text-primary mb-2">{{ stats.total_processed }}</div> <div class="fw-bold">Total Processed</div> <small class="text-muted">All processed results</small> </div> </div> </div> <div class="col-md-4"> <div class="card border-0 shadow-sm"> <div class="card-body text-center"> <div class="h2 text-success mb-2">{{ stats.approved }}</div> <div class="fw-bold">Approved</div> <small class="text-muted">Successfully approved</small> </div> </div> </div> <div class="col-md-4"> <div class="card border-0 shadow-sm"> <div class="card-body text-center"> <div class="h2 text-danger mb-2">{{ stats.rejected }}</div> <div class="fw-bold">Rejected</div> <small class="text-muted">Returned for correction</small> </div> </div> </div> </div> <!-- Filters --> <div class="row mb-4"> <div class="col-12"> <div class="card border-0 shadow-sm"> <div class="card-body"> <form method="get" class="row g-3"> <input type="hidden" name="level" value="{{ request.GET.level|default:'all' }}"> <div class="col-md-4"> <label class="form-label fw-semibold">Filter by Status</label> <select name="status" class="form-select"> <option value="">All Statuses</option> <option value="APPROVED_BY_EXAM_OFFICER" {% if status_filter == 'APPROVED_BY_EXAM_OFFICER' %}selected{% endif %}>Approved by Exam Officer</option> <option value="SUBMITTED_TO_DEAN" {% if status_filter == 'SUBMITTED_TO_DEAN' %}selected{% endif %}>Submitted to Dean</option> <option value="APPROVED_BY_DEAN" {% if status_filter == 'APPROVED_BY_DEAN' %}selected{% endif %}>Approved by Dean</option> <option value="PUBLISHED" {% if status_filter == 'PUBLISHED' %}selected{% endif %}>Published</option> <option value="REJECTED" {% if status_filter == 'REJECTED' %}selected{% endif %}>Rejected</option> </select> </div> <div class="col-md-4"> <label class="form-label fw-semibold">Filter by Course</label> <select name="course" class="form-select"> <option value="">All Courses</option> {% for course in courses %} <option value="{{ course.id }}" {% if course_filter == course.id|stringformat:"s" %}selected{% endif %}> {{ course.code }} - {{ course.title }} </option> {% endfor %} </select> </div> <div class="col-md-4"> <label class="form-label fw-semibold">&nbsp;</label> <div class="d-grid gap-2"> <button type="submit" class="btn btn-primary"> <i class="bi bi-funnel me-1"></i>Apply Filters </button> <a href="{% url 'exam_officer_result_history' %}?level={{ request.GET.level|default:'all' }}" class="btn btn-outline-secondary btn-sm"> <i class="bi bi-x-circle me-1"></i>Clear </a> </div> </div> </form> </div> </div> </div> </div> <!-- Results Table --> <div class="row"> <div class="col-12"> <div class="card border-0 shadow-sm"> <div class="card-header bg-light"> <h5 class="mb-0 fw-bold"> <i class="bi bi-archive me-2"></i>Processed Results History </h5> </div> <div class="card-body"> {% if processed_results %} <div class="table-responsive"> <table class="table table-hover"> <thead class="table-light"> <tr> <th>Student</th> <th>Course</th> <th>Scores</th> <th>Grade</th> <th>Status</th> <th>Processed Date</th> <th>Actions</th> </tr> </thead> <tbody> {% for result in processed_results %} <tr> <td> <div class="fw-bold">{{ result.enrollment.student.matric_number }}</div> <small class="text-muted">{{ result.enrollment.student.user.get_full_name }}</small> </td> <td> <div class="fw-semibold">{{ result.enrollment.course.code }}</div> <small class="text-muted">{{ result.enrollment.course.title }}</small> </td> <td> <small> CA: {{ result.ca_score|floatformat:1 }}<br> Exam: {{ result.exam_score|floatformat:1 }}<br> <strong>Total: {{ result.total_score|floatformat:1 }}</strong> </small> </td> <td> <span class="badge {% if result.grade == 'A' %}bg-success{% elif result.grade == 'B' %}bg-primary{% elif result.grade == 'C' %}bg-info{% elif result.grade == 'D' %}bg-warning{% else %}bg-danger{% endif %}"> {{ result.grade }} </span> </td> <td> {% if result.status == 'REJECTED' %} <span class="badge bg-danger">{{ result.get_workflow_stage }}</span> {% elif result.status == 'PUBLISHED' %} <span class="badge bg-success">{{ result.get_workflow_stage }}</span> {% else %} <span class="badge bg-info">{{ result.get_workflow_stage }}</span> {% endif %} </td> <td> <small>{{ result.updated_at|date:"M d, Y H:i" }}</small> </td> <td> <button class="btn btn-outline-primary btn-sm" onclick="viewResultDetails({{ result.id }})"> <i class="bi bi-eye me-1"></i>View </button> </td> </tr> {% endfor %} </tbody> </table> </div> <!-- Pagination --> {% if processed_results.has_other_pages %} <nav aria-label="Results pagination" class="mt-4"> <ul class="pagination justify-content-center"> {% if processed_results.has_previous %} <li class="page-item"> <a class="page-link" href="?page={{ processed_results.previous_page_number }}{% if request.GET.level %}&level={{ request.GET.level }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if course_filter %}&course={{ course_filter }}{% endif %}">Previous</a> </li> {% endif %} <li class="page-item active"> <span class="page-link">Page {{ processed_results.number }} of {{ processed_results.paginator.num_pages }}</span> </li> {% if processed_results.has_next %} <li class="page-item"> <a class="page-link" href="?page={{ processed_results.next_page_number }}{% if request.GET.level %}&level={{ request.GET.level }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if course_filter %}&course={{ course_filter }}{% endif %}">Next</a> </li> {% endif %} </ul> </nav> {% endif %} {% else %} <div class="text-center py-5"> <i class="bi bi-archive text-muted" style="font-size: 3rem;"></i> <h5 class="text-muted mt-3">No Processed Results</h5> <p class="text-muted">No results have been processed yet for the selected criteria.</p> <a href="{% url 'exam_officer_pending_results' %}" class="btn btn-primary"> <i class="bi bi-clock-history me-1"></i>View Pending Results </a> </div> {% endif %} </div> </div> </div> </div> <!-- Back to Dashboard --> <div class="row mt-4"> <div class="col-12 text-center"> <a href="{% url 'exam_officer_dashboard' %}" class="btn btn-outline-secondary"> <i class="bi bi-arrow-left me-1"></i>Back to Dashboard </a> </div> </div> </div> <script> function viewResultDetails(resultId) { // For now, show an alert. Can be enhanced to show a modal with full details alert('Result details view will be implemented. Result ID: ' + resultId); } </script> {% endblock %} 