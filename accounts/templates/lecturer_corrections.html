{% extends 'base.html' %} {% load role_tags %} {% block title %}Result Corrections - Lecturer{% endblock %} {% block content %} <div class="container-fluid"> <!-- Delegation Status Badges --> {% show_delegation_badges user %} <!-- Header --> <div class="row mb-4"> <div class="col-12"> <div class="card border-0 shadow-sm" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white;"> <div class="card-body"> <div class="row align-items-center"> <div class="col-md-8"> <h1 class="mb-1 fw-bold">Result Corrections</h1> <p class="mb-0 opacity-75">Review and correct rejected results</p> </div> <div class="col-md-4 text-center"> <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 12px;"> <div class="h3 fw-bold mb-0">{{ total_rejected }}</div> <small class="opacity-75">Rejected Results</small> </div> </div> </div> </div> </div> </div> </div> <!-- Rejected Results --> {% if rejected_results %} <div class="row"> <div class="col-12"> <div class="card border-0 shadow-sm"> <div class="card-header bg-danger text-white"> <h5 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Results Requiring Correction</h5> </div> <div class="card-body"> {% for item in rejected_results %} <div class="card mb-3 border-danger"> <div class="card-header bg-light"> <div class="row align-items-center"> <div class="col-md-8"> <h6 class="mb-0"> <strong>{{ item.result.enrollment.student.matric_number }}</strong> - {{ item.result.enrollment.student.user.get_full_name }} </h6> <small class="text-muted"> {{ item.course.code }} - {{ item.course.title }} ({{ item.session.name }}) </small> </div> <div class="col-md-4 text-end"> <span class="badge bg-danger">{{ item.result.get_status_display }}</span> </div> </div> </div> <div class="card-body"> <div class="row"> <div class="col-md-6"> <h6 class="text-danger">Rejection Details</h6> <div class="alert alert-danger"> <strong>Rejected by:</strong> {{ item.result.rejected_by.get_full_name }}<br> <strong>Date:</strong> {{ item.result.rejection_date|date:"M d, Y H:i" }}<br> <strong>Reason:</strong><br> {{ item.result.rejection_reason }} </div> </div> <div class="col-md-6"> <h6 class="text-primary">Current Scores</h6> <form method="post" action="{% url 'lecturer_resubmit' %}"> {% csrf_token %} <input type="hidden" name="result_id" value="{{ item.result.id }}"> <div class="row"> <div class="col-md-6 mb-3"> <label for="ca_score_{{ item.result.id }}" class="form-label">CA Score</label> <input type="number" class="form-control" id="ca_score_{{ item.result.id }}" name="ca_score" value="{{ item.result.ca_score|default:'' }}" min="0" max="30" step="0.01" required> </div> <div class="col-md-6 mb-3"> <label for="exam_score_{{ item.result.id }}" class="form-label">Exam Score</label> <input type="number" class="form-control" id="exam_score_{{ item.result.id }}" name="exam_score" value="{{ item.result.exam_score|default:'' }}" min="0" max="70" step="0.01" required> </div> </div> <div class="row"> <div class="col-md-6"> <div class="alert alert-info"> <strong>Current Total:</strong> {{ item.result.total_score|default:"Not calculated" }}<br> <strong>Current Grade:</strong> {{ item.result.grade|default:"Not assigned" }} </div> </div> <div class="col-md-6 text-end"> <button type="submit" class="btn btn-success" onclick="return confirm('Are you sure you want to resubmit this corrected result?')"> <i class="bi bi-check-circle me-1"></i>Resubmit Result </button> </div> </div> </form> </div> </div> </div> </div> {% endfor %} </div> </div> </div> </div> {% else %} <div class="row"> <div class="col-12"> <div class="card border-0 shadow-sm"> <div class="card-body text-center py-5"> <i class="bi bi-check-circle text-success" style="font-size: 4rem;"></i> <h3 class="mt-3 text-success">No Corrections Needed</h3> <p class="text-muted">All your submitted results have been approved or are pending review.</p> <a href="{% url 'lecturer_result_status' %}" class="btn btn-primary"> <i class="bi bi-list-check me-2"></i>View Result Status </a> </div> </div> </div> </div> {% endif %} <!-- Navigation --> <div class="row mt-4"> <div class="col-12"> <div class="d-flex gap-2"> <a href="{% url 'lecturer_dashboard' %}" class="btn btn-secondary"> <i class="bi bi-arrow-left me-2"></i>Back to Dashboard </a> <a href="{% url 'lecturer_result_status' %}" class="btn btn-outline-primary"> <i class="bi bi-list-check me-2"></i>View All Results </a> <a href="{% url 'lecturer_enter_results' %}" class="btn btn-outline-success"> <i class="bi bi-plus-circle me-2"></i>Enter New Results </a> </div> </div> </div> </div> <script> // Auto-calculate total score when CA or Exam scores change document.addEventListener('DOMContentLoaded', function() { const forms = document.querySelectorAll('form'); forms.forEach(form => { const caInput = form.querySelector('input[name="ca_score"]'); const examInput = form.querySelector('input[name="exam_score"]'); if (caInput && examInput) { function updateTotal() { const ca = parseFloat(caInput.value) || 0; const exam = parseFloat(examInput.value) || 0; const total = ca + exam; // Find the alert showing current total const alert = form.querySelector('.alert-info'); if (alert) { let grade = 'F'; if (total >= 70) grade = 'A'; else if (total >= 60) grade = 'B'; else if (total >= 50) grade = 'C'; else if (total >= 45) grade = 'D'; alert.innerHTML = ` <strong>New Total:</strong> ${total.toFixed(2)}<br> <strong>New Grade:</strong> ${grade} `; } } caInput.addEventListener('input', updateTotal); examInput.addEventListener('input', updateTotal); } }); }); </script> {% endblock %} 