{% load role_tags %}

<!-- Delegation Status Badges - Bootstrap 5 Responsive -->
{% if delegated_roles %}
<div class="delegation-badges-container mb-3">
    <div class="alert alert-info border-start border-4 border-primary rounded-3 p-3" style="background: rgba(13, 110, 253, 0.1);">
        <div class="d-flex align-items-center gap-2 mb-3">
            <i class="bi bi-shield-check text-primary fs-5"></i>
            <h6 class="mb-0 fw-semibold text-primary">Acting with Delegated Permissions</h6>
        </div>

        <div class="d-flex flex-wrap gap-2 mb-3">
            {% for role_info in delegated_roles %}
            <span class="badge bg-primary bg-opacity-10 text-primary border border-primary rounded-pill px-3 py-2"
                  style="font-size: 0.75rem; font-weight: 600;"
                  title="Delegated from {{ role_info.delegated_from.get_full_name }}"
                  data-bs-toggle="tooltip" data-bs-placement="top">
                <i class="bi bi-arrow-right me-1" style="font-size: 0.7rem;"></i>
                {% get_role_display_name role_info.role %}
            </span>
            {% endfor %}
        </div>

        <div class="small text-muted">
            <i class="bi bi-info-circle me-1"></i>
            You have temporary access to additional role permissions. When you access role dashboards, you'll see the actual data and context for the delegated role. These permissions will be automatically revoked when the delegation expires.
        </div>
    </div>
</div>
{% endif %}

<!-- Detailed Delegation Information (Expandable) - Bootstrap 5 -->
{% if delegated_roles %}
<div class="delegation-details-container mb-4">
    <button class="btn btn-outline-primary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#delegationDetails" aria-expanded="false" aria-controls="delegationDetails">
        <i class="bi bi-chevron-down me-1"></i>
        View Delegation Details
    </button>

    <div class="collapse" id="delegationDetails">
        <div class="card mt-3 border rounded-3">
            <div class="card-body p-3">
                <h6 class="card-title mb-3 fw-semibold">Delegation Information</h6>

                {% for role_info in delegated_roles %}
                <div class="delegation-item p-3 bg-light rounded-2 mb-3">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <strong class="text-primary">{% get_role_display_name role_info.role %}</strong>
                            <div class="small text-muted mt-1">
                                Delegated from: <strong>{{ role_info.delegated_from.get_full_name }}</strong>
                            </div>
                        </div>
                        <span class="badge bg-success" style="font-size: 0.7rem;">Active</span>
                    </div>

                    {% if role_info.delegation.reason %}
                    <div class="small text-dark mb-2">
                        <strong>Reason:</strong> {{ role_info.delegation.reason|truncatewords:15 }}
                    </div>
                    {% endif %}

                    <div class="small text-muted">
                        <i class="bi bi-clock me-1"></i>
                        Delegated on: {{ role_info.delegation.created_at|date:"M d, Y \a\t H:i" }}
                    </div>

                    {% if role_info.faculty %}
                    <div class="small text-muted mt-1">
                        <i class="bi bi-building me-1"></i>
                        Faculty: {{ role_info.faculty.name }}
                        {% if role_info.department %}
                        | Department: {{ role_info.department.name }}
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
/* Bootstrap 5 Compatible Delegation Badges Styles */
.delegation-badges-container .badge {
    transition: all 0.2s ease-in-out;
}

.delegation-badges-container .badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 0.125rem 0.5rem rgba(13, 110, 253, 0.3);
}

.delegation-item {
    transition: all 0.2s ease-in-out;
}

.delegation-item:hover {
    background-color: var(--bs-gray-200) !important;
}

/* Responsive Design for All Viewports */
@media (max-width: 575.98px) {
    /* Extra small devices (phones) */
    .delegation-badges-container .alert {
        padding: 0.75rem;
    }

    .delegation-badges-container .badge {
        font-size: 0.7rem;
        padding: 0.375rem 0.625rem;
    }

    .delegation-badges-container h6 {
        font-size: 0.9rem;
    }
}

@media (min-width: 576px) and (max-width: 767.98px) {
    /* Small devices (landscape phones) */
    .delegation-badges-container .alert {
        padding: 0.875rem;
    }
}

@media (min-width: 768px) and (max-width: 991.98px) {
    /* Medium devices (tablets) */
    .delegation-badges-container .alert {
        padding: 1rem;
    }
}

@media (min-width: 992px) {
    /* Large devices (desktops) and up */
    .delegation-badges-container .alert {
        padding: 1rem;
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    .delegation-item:hover {
        background-color: var(--bs-gray-700) !important;
    }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .delegation-badges-container .badge {
        border-width: 2px;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .delegation-badges-container .badge,
    .delegation-item {
        transition: none;
    }

    .delegation-badges-container .badge:hover {
        transform: none;
    }
}
</style>

<!-- Initialize Bootstrap tooltips -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap 5 tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
