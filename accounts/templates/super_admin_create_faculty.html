{% extends 'base.html' %}

{% block title %}Create Faculty - Super Admin{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1 class="page-title">Create New Faculty</h1>
    <p class="page-subtitle">Add a new faculty to the university system</p>
</div>

<!-- Create Faculty Form -->
<div class="ios-card" style="margin-bottom: 32px;">
    <h2 style="color: var(--text-primary); margin-bottom: 24px; font-size: 22px; font-weight: 600;">Faculty Information</h2>
    
    <form method="post" action="{% url 'super_admin_create_faculty' %}">
        {% csrf_token %}
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Faculty Name *</label>
                <input type="text" name="name" required style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="e.g., Faculty of Engineering" value="{{ form_data.name }}">
                {% if errors.name %}
                    <div style="color: var(--ios-red); font-size: 12px; margin-top: 4px;">{{ errors.name }}</div>
                {% endif %}
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Faculty Code *</label>
                <input type="text" name="code" required style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="e.g., ENG" value="{{ form_data.code }}">
                {% if errors.code %}
                    <div style="color: var(--ios-red); font-size: 12px; margin-top: 4px;">{{ errors.code }}</div>
                {% endif %}
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Description</label>
            <textarea name="description" rows="4" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; resize: vertical;" placeholder="Brief description of the faculty">{{ form_data.description }}</textarea>
        </div>
        
        <div style="display: flex; gap: 12px;">
            <button type="submit" class="btn btn-primary">Create Faculty</button>
            <a href="{% url 'super_admin_dashboard' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<!-- Assign Faculty Dean Section -->
<div class="ios-card" style="margin-bottom: 32px;">
    <h2 style="color: var(--text-primary); margin-bottom: 24px; font-size: 22px; font-weight: 600;">Create User & Assign as Faculty Dean</h2>
    
    <form method="post" action="{% url 'super_admin_create_faculty_with_dean' %}">
        {% csrf_token %}
        
        <!-- Faculty Information -->
        <div style="background: var(--surface-secondary); padding: 20px; border-radius: 12px; margin-bottom: 24px;">
            <h3 style="color: var(--ios-blue); margin-bottom: 16px; font-size: 18px; font-weight: 600;">Faculty Information</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Faculty Name *</label>
                    <input type="text" name="faculty_name" required style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="e.g., Faculty of Science">
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Faculty Code *</label>
                    <input type="text" name="faculty_code" required style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="e.g., SCI">
                </div>
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Faculty Description</label>
                <textarea name="faculty_description" rows="3" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; resize: vertical;" placeholder="Brief description of the faculty"></textarea>
            </div>
        </div>
        
        <!-- Dean User Information -->
        <div style="background: var(--surface-secondary); padding: 20px; border-radius: 12px; margin-bottom: 24px;">
            <h3 style="color: var(--ios-blue); margin-bottom: 16px; font-size: 18px; font-weight: 600;">Faculty Dean Information</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">First Name *</label>
                    <input type="text" name="first_name" required style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="Dean's first name">
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Last Name *</label>
                    <input type="text" name="last_name" required style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="Dean's last name">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Email Address *</label>
                    <input type="email" name="email" required style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="dean@university.edu">
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Username *</label>
                    <input type="text" name="username" required style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="dean_username">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Password *</label>
                    <div style="position: relative;">
                        <input type="password" id="dean_password" name="password" required style="width: 100%; padding: 12px 40px 12px 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="Secure password">
                        <button type="button" onclick="togglePassword('dean_password')"
                                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 12px; padding: 4px;">
                            Show
                        </button>
                    </div>
                </div>

                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Confirm Password *</label>
                    <div style="position: relative;">
                        <input type="password" id="dean_confirm_password" name="confirm_password" required style="width: 100%; padding: 12px 40px 12px 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;" placeholder="Confirm password">
                        <button type="button" onclick="togglePassword('dean_confirm_password')"
                                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 12px; padding: 4px;">
                            Show
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div style="display: flex; gap: 12px;">
            <button type="submit" class="btn btn-primary">Create Faculty & Assign Dean</button>
            <a href="{% url 'super_admin_dashboard' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<!-- Existing Faculties -->
<div class="ios-card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="color: var(--text-primary); font-size: 20px; font-weight: 600; margin: 0;">Existing Faculties</h2>
        <a href="{% url 'super_admin_manage_faculties' %}" style="color: var(--ios-blue); text-decoration: none; font-weight: 500;">Manage All</a>
    </div>
    
    {% if faculties %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: var(--surface-secondary);">
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary);">Faculty</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary);">Code</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary);">Dean</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary);">Departments</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary);">Students</th>
                        <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary);">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for faculty in faculties %}
                    <tr style="border-bottom: 1px solid var(--border-light);">
                        <td style="padding: 12px;">
                            <div style="font-weight: 600; color: var(--text-primary);">{{ faculty.name }}</div>
                            <div style="color: var(--text-secondary); font-size: 12px;">Created: {{ faculty.created_at|date:"M d, Y" }}</div>
                        </td>
                        <td style="padding: 12px; color: var(--text-secondary); font-family: monospace;">{{ faculty.code }}</td>
                        <td style="padding: 12px;">
                            {% if faculty.dean %}
                                <div style="color: var(--text-primary); font-weight: 500;">{{ faculty.dean.get_full_name }}</div>
                                <div style="color: var(--text-secondary); font-size: 12px;">{{ faculty.dean.email }}</div>
                            {% else %}
                                <span style="color: var(--ios-red); font-size: 14px;">No Dean Assigned</span>
                            {% endif %}
                        </td>
                        <td style="padding: 12px; color: var(--text-secondary);">{{ faculty.departments_count }}</td>
                        <td style="padding: 12px; color: var(--text-secondary);">{{ faculty.students_count }}</td>
                        <td style="padding: 12px;">
                            <div style="display: flex; gap: 8px;">
                                <a href="{% url 'super_admin_faculty_details' faculty.id %}" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">View</a>
                                {% if not faculty.dean %}
                                    <a href="{% url 'super_admin_assign_dean_single' faculty.id %}" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">Assign Dean</a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
            <p>No faculties created yet</p>
        </div>
    {% endif %}
</div>

<script>
    // Password toggle function
    function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        const button = field.parentElement.querySelector('button');

        if (field.type === 'password') {
            field.type = 'text';
            button.textContent = 'Hide';
        } else {
            field.type = 'password';
            button.textContent = 'Show';
        }
    }
</script>

{% endblock %}
