{% extends 'base.html' %} {% block title %}Permission Delegations - RMS{% endblock %} {% block content %} <style> :root { --royal-blue: #1e3a8a; --royal-blue-light: #3b82f6; --royal-blue-ultra-light: rgba(30, 58, 138, 0.1); --royal-blue-gradient: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); --ios-green: #3b82f6; /* Changed to blue variant */ --ios-orange: #1e40af; /* Changed to dark blue */ --ios-red: #dc2626; /* School brand red */ --text-primary: #1D1D1F; --text-secondary: #86868B; --surface-primary: #FFFFFF; --surface-secondary: #F2F2F7; --border-light: #E5E5EA; } .delegation-card { background: var(--surface-primary); border: 1px solid var(--border-light); border-radius: 16px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); } .delegation-card:hover { box-shadow: 0 8px 25px rgba(0,0,0,0.1); } .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; } .status-active { background: var(--ios-green); color: white; } .status-expired { background: var(--ios-orange); color: white; } .status-revoked { background: var(--ios-red); color: white; } .btn-revoke { background: var(--ios-red); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; } .btn-revoke:hover { box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3); } .filter-tabs { display: flex; gap: 8px; margin-bottom: 24px; background: var(--surface-secondary); padding: 8px; border-radius: 12px; } .filter-tab { padding: 12px 20px; border-radius: 8px; background: transparent; border: none; font-weight: 600; cursor: pointer; } .filter-tab.active { background: var(--royal-blue); color: white; } </style> <div style="max-width: 1200px; margin: 0 auto; padding: 20px;"> <!-- Header --> <div style="background: var(--surface-primary); border-radius: 20px; padding: 32px; margin-bottom: 32px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);"> <div style="text-align: center;"> <h1 style="font-size: 32px; font-weight: 700; color: var(--text-primary); margin: 0 0 12px 0;"> Permission Delegations </h1> <p style="color: var(--text-secondary); font-size: 18px; margin: 0;"> Manage temporary permission delegations across the system </p> </div> <!-- Quick Stats --> <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 32px;"> <div style="text-align: center; padding: 16px; background: var(--royal-blue); color: white; border-radius: 12px;"> <div style="font-size: 24px; font-weight: 700;">{{ delegations|length }}</div> <div style="font-size: 12px; opacity: 0.9;">Total Delegations</div> </div> <div style="text-align: center; padding: 16px; background: var(--ios-green); color: white; border-radius: 12px;"> <div style="font-size: 24px; font-weight: 700;"> {{ delegations|length }} </div> <div style="font-size: 12px; opacity: 0.9;">Active</div> </div> <div style="text-align: center; padding: 16px; background: var(--ios-orange); color: white; border-radius: 12px;"> <div style="font-size: 24px; font-weight: 700;">0</div> <div style="font-size: 12px; opacity: 0.9;">Expired</div> </div> <div style="text-align: center; padding: 16px; background: var(--ios-red); color: white; border-radius: 12px;"> <div style="font-size: 24px; font-weight: 700;">0</div> <div style="font-size: 12px; opacity: 0.9;">Revoked</div> </div> </div> </div> <!-- Filter Tabs --> <div class="filter-tabs"> <button class="filter-tab active" onclick="filterDelegations('all')">All Delegations</button> <button class="filter-tab" onclick="filterDelegations('active')">Active</button> <button class="filter-tab" onclick="filterDelegations('expired')">Expired</button> <button class="filter-tab" onclick="filterDelegations('revoked')">Revoked</button> </div> <!-- Delegations List --> <div id="delegations-container"> {% for delegation in delegations %} <div class="delegation-card" data-status="{{ delegation.status|lower }}"> <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 16px;"> <div style="flex: 1;"> <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;"> <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin: 0;"> {{ delegation.get_delegated_role_display }} Delegation </h3> <span class="status-badge status-{{ delegation.status|lower }}"> {{ delegation.status }} </span> </div> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 16px;"> <div> <div style="font-size: 12px; color: var(--text-secondary); font-weight: 600; margin-bottom: 4px;">FROM (Original Role Holder)</div> <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);">{{ delegation.delegator.get_full_name }}</div> <div style="font-size: 14px; color: var(--text-secondary);">{{ delegation.delegator.email }}</div> </div> <div> <div style="font-size: 12px; color: var(--text-secondary); font-weight: 600; margin-bottom: 4px;">TO (Delegate)</div> <div style="font-size: 16px; font-weight: 600; color: var(--royal-blue);">{{ delegation.delegate.get_full_name }}</div> <div style="font-size: 14px; color: var(--text-secondary);">{{ delegation.delegate.email }}</div> </div> </div> <!-- Faculty/Department Info --> {% if delegation.faculty or delegation.department %} <div style="background: var(--surface-secondary); padding: 12px; border-radius: 8px; margin-bottom: 16px;"> {% if delegation.faculty %} <div style="font-size: 14px; color: var(--text-primary);"> <strong>Faculty:</strong> {{ delegation.faculty.name }} </div> {% endif %} {% if delegation.department %} <div style="font-size: 14px; color: var(--text-primary);"> <strong>Department:</strong> {{ delegation.department.name }} </div> {% endif %} </div> {% endif %} <!-- Time Period --> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 16px;"> <div> <div style="font-size: 12px; color: var(--text-secondary); font-weight: 600;">Start Date</div> <div style="font-size: 14px; color: var(--text-primary);">{{ delegation.start_date|date:"M d, Y H:i" }}</div> </div> <div> <div style="font-size: 12px; color: var(--text-secondary); font-weight: 600;">End Date</div> <div style="font-size: 14px; color: var(--text-primary);">{{ delegation.end_date|date:"M d, Y H:i" }}</div> </div> </div> <!-- Reason --> <div style="margin-bottom: 16px;"> <div style="font-size: 12px; color: var(--text-secondary); font-weight: 600; margin-bottom: 4px;">Reason</div> <div style="font-size: 14px; color: var(--text-primary); background: var(--surface-secondary); padding: 8px 12px; border-radius: 8px;"> {{ delegation.reason }} </div> </div> <!-- Created By --> <div style="font-size: 12px; color: var(--text-secondary);"> Created by {{ delegation.created_by.get_full_name }} on {{ delegation.created_at|date:"M d, Y H:i" }} {% if delegation.revoked_by %} <br>Revoked by {{ delegation.revoked_by.get_full_name }} on {{ delegation.revoked_at|date:"M d, Y H:i" }} {% endif %} </div> </div> <!-- Actions --> <div style="display: flex; flex-direction: column; gap: 8px;"> {% if delegation.status == 'ACTIVE' %} <!-- Quick Revoke Button --> <button class="btn btn-danger btn-sm quick-revoke-btn" data-delegation-id="{{ delegation.id }}" data-delegate-name="{{ delegation.delegate.get_full_name }}" data-role-display="{{ delegation.get_delegated_role_display }}" title="Quick revoke without reason"> <i class="fas fa-times"></i> Quick Revoke </button> <!-- Detailed Revoke Button --> <button class="btn btn-outline-danger btn-sm revoke-delegation-btn" data-delegation-id="{{ delegation.id }}" data-delegate-name="{{ delegation.delegate.get_full_name }}" data-role-display="{{ delegation.get_delegated_role_display }}" title="Revoke with reason"> <i class="fas fa-edit"></i> Revoke with Reason </button> <!-- Delegation Info --> <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;"> {% if delegation.delegated_role.faculty %} <i class="fas fa-building"></i> {{ delegation.delegated_role.faculty.name }} {% else %} <i class="fas fa-globe"></i> Cross-Faculty {% endif %} {% if delegation.end_date %} <br><i class="fas fa-clock"></i> {{ delegation.get_time_remaining }} {% endif %} </div> {% endif %} <button class="btn btn-primary btn-sm view-delegation-btn" data-delegation-id="{{ delegation.id }}"> <i class="fas fa-eye"></i> Details </button> </div> </div> </div> {% empty %} <div style="text-align: center; padding: 40px; background: var(--surface-primary); border-radius: 20px;"> <h3 style="font-size: 20px; margin-bottom: 8px;">No Permission Delegations</h3> <p style="color: var(--text-secondary); margin-bottom: 24px;">No permission delegations have been created yet.</p> <a href="{% url 'super_admin_manage_users' %}" style="background: var(--royal-blue); color: white; padding: 12px 24px; border-radius: 12px; text-decoration: none; font-weight: 600;"> Manage Users </a> </div> {% endfor %} </div> </div> <!-- Revoke Modal --> <div id="revokeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; backdrop-filter: blur(5px);"> <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 20px; padding: 32px; width: 90%; max-width: 500px; box-shadow: 0 20px 40px rgba(0,0,0,0.3);"> <h2 style="font-size: 24px; font-weight: 700; color: var(--ios-red); margin: 0 0 24px 0;">⚠️ Revoke Permission Delegation</h2> <div id="revoke-info" style="background: var(--surface-secondary); padding: 16px; border-radius: 12px; margin-bottom: 24px;"> <!-- Dynamic content will be inserted here --> </div> <form id="revokeForm" method="post"> {% csrf_token %} <div style="margin-bottom: 20px;"> <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">Reason for Revocation</label> <textarea name="reason" required rows="3" style="width: 100%; padding: 12px 16px; border: 1px solid var(--border-light); border-radius: 12px; font-size: 16px; resize: vertical;" placeholder="e.g., Task completed, original user returned, emergency resolved..."></textarea> </div> <div style="display: flex; gap: 12px; justify-content: flex-end;"> <button type="button" onclick="hideRevokeModal()" style="background: var(--surface-secondary); color: var(--text-primary); padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;"> Cancel </button> <button type="submit" style="background: var(--ios-red); color: white; padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;"> Revoke Delegation </button> </div> </form> </div> </div> <script> function filterDelegations(status) { const cards = document.querySelectorAll('.delegation-card'); const tabs = document.querySelectorAll('.filter-tab'); // Update active tab tabs.forEach(tab => tab.classList.remove('active')); event.target.classList.add('active'); // Filter cards cards.forEach(card => { if (status === 'all' || card.dataset.status === status) { card.style.display = 'block'; } else { card.style.display = 'none'; } }); } function showRevokeModal(delegationId, delegateName, roleName) { document.getElementById('revoke-info').innerHTML = ` <div style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;"> Revoking ${roleName} delegation for: </div> <div style="font-size: 18px; font-weight: 700; color: var(--ios-red);"> ${delegateName} </div> `; document.getElementById('revokeForm').action = `/super-admin/revoke-delegation/${delegationId}/`; document.getElementById('revokeModal').style.display = 'block'; } function hideRevokeModal() { document.getElementById('revokeModal').style.display = 'none'; } function submitQuickRevocation(delegationId) { // Create and submit form for quick revocation const form = document.createElement('form'); form.method = 'POST'; form.action = `/super-admin/revoke-delegation/${delegationId}/`; // Add CSRF token const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value; const csrfInput = document.createElement('input'); csrfInput.type = 'hidden'; csrfInput.name = 'csrfmiddlewaretoken'; csrfInput.value = csrfToken; form.appendChild(csrfInput); // Add quick revocation reason const reasonInput = document.createElement('input'); reasonInput.type = 'hidden'; reasonInput.name = 'reason'; reasonInput.value = 'Quick revocation by Super Admin'; form.appendChild(reasonInput); document.body.appendChild(form); form.submit(); } function viewDelegationDetails(delegationId) { // This would open a detailed view modal or navigate to a details page alert(`View details for delegation ${delegationId}`); } // Add touch feedback document.addEventListener('DOMContentLoaded', function() { const buttons = document.querySelectorAll('button, .btn-revoke'); buttons.forEach(button => { button.addEventListener('touchstart', function() { this.style.transform = 'scale(0.98)'; }); button.addEventListener('touchend', function() { this.style.transform = 'scale(1)'; }); }); // Add event listeners for delegation buttons document.querySelectorAll('.quick-revoke-btn').forEach(button => { button.addEventListener('click', function() { const delegationId = this.getAttribute('data-delegation-id'); const delegateName = this.getAttribute('data-delegate-name'); const roleDisplay = this.getAttribute('data-role-display'); if (confirm(`Are you sure you want to quickly revoke the ${roleDisplay} delegation for ${delegateName}?\n\nThis will revoke immediately without requiring a detailed reason.`)) { submitQuickRevocation(delegationId); } }); }); document.querySelectorAll('.revoke-delegation-btn').forEach(button => { button.addEventListener('click', function() { const delegationId = this.getAttribute('data-delegation-id'); const delegateName = this.getAttribute('data-delegate-name'); const roleDisplay = this.getAttribute('data-role-display'); showRevokeModal(delegationId, delegateName, roleDisplay); }); }); document.querySelectorAll('.view-delegation-btn').forEach(button => { button.addEventListener('click', function() { const delegationId = this.getAttribute('data-delegation-id'); viewDelegationDetails(delegationId); }); }); }); </script> {% endblock %} 